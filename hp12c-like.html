<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>TIR, VPL, Payback e Montante | SimulaLucro</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Calculadora financeira completa: TIR, VPL, Payback simples e descontado, FV e PMT com fluxo de caixa por perÃ­odo.">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f3f6fb;
  color:#1f2937;
}
header{
  background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.08);
}
.container{
  max-width:1100px;
  margin:auto;
  padding:24px 16px;
}
.card{
  background:#fff;
  padding:24px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  margin-bottom:32px;
}
.flow-header,.flow-row{
  display:grid;
  grid-template-columns:120px 110px 100px 36px;
  gap:8px;
  align-items:center;
}
.flow-header{font-weight:700}
.flow-row{margin-bottom:8px}
input,select,button{
  padding:8px;
  border-radius:8px;
  border:1px solid #d1d5db;
}
button{
  background:#2563eb;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
button:hover{background:#1d4ed8}
.remove{background:#ef4444}
.result{
  background:#ecfeff;
  padding:20px;
  border-radius:12px;
  margin-top:24px;
}
canvas{margin-top:24px;width:100%}
</style>
</head>

<body>

<header>
  <div class="container">
    <strong>ðŸ’° SimulaLucro</strong>
  </div>
</header>

<div class="container">

<div class="card">
<h1>ðŸ“Š TIR, VPL, Payback e Montante</h1>
<p>Fluxo de caixa por perÃ­odo (modelo HP12c-like).</p>

<div class="flow-header">
  <div>Data</div>
  <div>Valor (R$)</div>
  <div>Tipo</div>
  <div></div>
</div>

<div id="flows"></div>

<button onclick="addRow()">+ Adicionar linha</button>

<h3 style="margin-top:24px">Taxa de desconto (% por perÃ­odo)</h3>
<input id="rate" placeholder="Ex: 10">

<button style="margin-top:16px" onclick="calculate()">Calcular</button>

<div id="output" class="result" style="display:none"></div>

<canvas id="chart" height="200"></canvas>
</div>

<div class="card">
<h2>ðŸ“˜ Como usar</h2>
<ul>
<li>Primeira linha Ã© o <strong>CF0</strong> (investimento inicial â€“ SaÃ­da).</li>
<li>Entradas = receitas | SaÃ­das = custos.</li>
<li>A taxa deve ser por perÃ­odo (ex: mÃªs).</li>
</ul>
<p><strong>Esta calculadora Ã© educativa e nÃ£o constitui recomendaÃ§Ã£o financeira.</strong></p>
</div>

</div>

<script>
const flows=document.getElementById("flows");

function addRow(){
  const row=document.createElement("div");
  row.className="flow-row";
  row.innerHTML=`
    <input type="date">
    <input type="number" placeholder="Ex: 1000">
    <select>
      <option>Entrada</option>
      <option>SaÃ­da</option>
    </select>
    <button class="remove" onclick="this.parentElement.remove()">Ã—</button>
  `;
  flows.appendChild(row);
}

addRow(); // CF0

function calculate(){
  const rows=[...document.querySelectorAll(".flow-row")];
  const rate=Number(document.getElementById("rate").value)/100;

  if(rows.length<2){alert("Inclua CF0 e ao menos um fluxo.");return;}
  if(rate<=0){alert("Informe a taxa.");return;}

  let cfs=[];
  for(let i=0;i<rows.length;i++){
    const val=Number(rows[i].children[1].value);
    const type=rows[i].children[2].value;
    if(!val){alert("Preencha todos os valores.");return;}
    if(i===0 && type!=="SaÃ­da"){alert("CF0 deve ser SaÃ­da.");return;}
    cfs.push(type==="Entrada"?val:-val);
  }

  let vpl=0,acc=0,fv=0,pay=null,payd=null;
  cfs.forEach((cf,i)=>{
    const disc=cf/Math.pow(1+rate,i);
    vpl+=disc;
    acc+=cf;
    fv+=cf*Math.pow(1+rate,cfs.length-1-i);
    if(pay===null && acc>=0)pay=i;
    if(payd===null && vpl>=0)payd=i;
  });

  const tir=irr(cfs)*100;
  const pmt=(vpl*rate)/(1-Math.pow(1+rate,-cfs.length));

  const out=document.getElementById("output");
  out.style.display="block";
  out.innerHTML=`
    <strong>Resultados</strong><br><br>
    VPL: R$ ${vpl.toFixed(2)}<br>
    TIR: ${tir.toFixed(2)}%<br>
    FV: R$ ${fv.toFixed(2)}<br>
    PMT: R$ ${pmt.toFixed(2)}<br>
    Payback simples: ${pay ?? "NÃ£o recupera"} perÃ­odos<br>
    Payback descontado: ${payd ?? "NÃ£o recupera"} perÃ­odos
  `;

  drawChart(cfs);
}

function irr(cfs){
  let r=0.1;
  for(let i=0;i<500;i++){
    let f=0,df=0;
    cfs.forEach((cf,t)=>{
      f+=cf/Math.pow(1+r,t);
      df+=-t*cf/Math.pow(1+r,t+1);
    });
    r-=f/df;
  }
  return r;
}

function drawChart(cfs){
  const canvas=document.getElementById("chart");
  const ctx=canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const max=Math.max(...cfs.map(v=>Math.abs(v)))||1;
  let acc=0;

  cfs.forEach((v,i)=>{
    acc+=v;
    const h=(v/max)*80;
    ctx.fillStyle=v>=0?"#22c55e":"#ef4444";
    ctx.fillRect(i*60+20,100-h,30,h);
    ctx.fillStyle="#000";
    ctx.fillText(acc.toFixed(0),i*60+20,190);
  });
}
</script>

</body>
</html>
