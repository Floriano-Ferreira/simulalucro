<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>TIR, VPL, Payback e Montante (HP12c-like) | SimulaLucro</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Calculadora financeira HP12c-like online. Calcule TIR, VPL, Payback simples e descontado, FV e PMT com fluxo de caixa por per√≠odo.">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f3f6fb;
  color:#1f2937;
}
header{
  background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.08);
}
.container{
  max-width:1100px;
  margin:auto;
  padding:24px 16px;
}
.card{
  background:#fff;
  padding:24px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  margin-bottom:32px;
}
h1,h2{margin-top:0}
.flow-header,.flow-row{
  display:grid;
  grid-template-columns:130px 120px 110px 40px;
  gap:8px;
  align-items:center;
}
.flow-header{
  font-weight:700;
  margin-bottom:8px;
}
.flow-row{margin-bottom:8px}
input,select,button{
  padding:8px;
  border-radius:8px;
  border:1px solid #d1d5db;
  font-size:14px;
}
button{
  cursor:pointer;
  background:#2563eb;
  color:#fff;
  border:none;
  font-weight:700;
}
button:hover{background:#1d4ed8}
.remove{
  background:#ef4444;
}
.add{
  margin-top:12px;
}
.result{
  background:#ecfeff;
  padding:20px;
  border-radius:12px;
  margin-top:24px;
}
canvas{margin-top:24px}
@media(max-width:600px){
  .flow-header,.flow-row{
    grid-template-columns:110px 100px 90px 36px;
  }
}
</style>
</head>

<body>

<header>
  <div class="container">
    <strong>üí∞ SimulaLucro</strong>
  </div>
</header>

<div class="container">

<div class="card">
<h1>üìä TIR, VPL, Payback e Montante (HP12c-like)</h1>
<p>Calculadora financeira avan√ßada baseada em fluxo de caixa por per√≠odo.</p>

<h2>Fluxo de Caixa</h2>

<div class="flow-header">
  <div>Data</div>
  <div>Valor (R$)</div>
  <div>Tipo</div>
  <div></div>
</div>

<div id="flows"></div>

<button class="add" onclick="addRow()">+ Adicionar linha</button>

<h2 style="margin-top:32px">Taxa de desconto (% por per√≠odo)</h2>
<input id="rate" placeholder="Ex: 10">

<button style="margin-top:16px" onclick="calculate()">Calcular</button>

<div id="output" class="result" style="display:none"></div>

<canvas id="chart" height="120"></canvas>

</div>

<div class="card">
<h2>üìò Explica√ß√£o das Vari√°veis</h2>
<ul>
<li><strong>CF0:</strong> Investimento inicial (obrigat√≥rio, normalmente negativo).</li>
<li><strong>Entradas:</strong> Receitas ou retornos.</li>
<li><strong>Sa√≠das:</strong> Custos ou investimentos.</li>
<li><strong>VPL:</strong> Valor presente do projeto.</li>
<li><strong>TIR:</strong> Taxa que zera o VPL.</li>
<li><strong>Payback:</strong> Tempo para recuperar o investimento.</li>
<li><strong>Payback descontado:</strong> Considera o valor do dinheiro no tempo.</li>
<li><strong>FV:</strong> Valor acumulado ao final.</li>
<li><strong>PMT:</strong> Valor m√©dio peri√≥dico equivalente.</li>
</ul>

<p><strong>Este c√°lculo √© educativo e n√£o constitui recomenda√ß√£o financeira.</strong></p>
</div>

</div>

<script>
let flowsDiv=document.getElementById("flows");

function addRow(date="",value="",type="Sa√≠da"){
  let row=document.createElement("div");
  row.className="flow-row";
  row.innerHTML=`
    <input type="date" value="${date}">
    <input type="number" placeholder="Ex: 1000" value="${value}">
    <select>
      <option ${type==="Entrada"?"selected":""}>Entrada</option>
      <option ${type==="Sa√≠da"?"selected":""}>Sa√≠da</option>
    </select>
    <button class="remove" onclick="this.parentElement.remove()">√ó</button>
  `;
  flowsDiv.appendChild(row);
}

addRow(); // CF0 obrigat√≥rio

function calculate(){
  let rows=[...document.querySelectorAll(".flow-row")];
  if(rows.length<2){alert("Inclua CF0 e pelo menos um fluxo.");return;}

  let rate=Number(document.getElementById("rate").value)/100;
  if(rate<=0){alert("Informe a taxa.");return;}

  let cashflows=[];
  rows.forEach((r,i)=>{
    let v=Number(r.children[1].value);
    let t=r.children[2].value;
    if(i===0 && t!=="Sa√≠da"){alert("CF0 deve ser Sa√≠da.");throw"";}
    cashflows.push(t==="Entrada"?v:-v);
  });

  let vpl=0,acc=0,fv=0,pay=null,payd=null;
  cashflows.forEach((cf,i)=>{
    let d=cf/Math.pow(1+rate,i);
    vpl+=d;
    acc+=cf;
    fv+=cf*Math.pow(1+rate, cashflows.length-1-i);
    if(pay===null && acc>=0)pay=i;
    if(payd===null && (vpl)>=0)payd=i;
  });

  let tir=calcIRR(cashflows)*100;
  let pmt=(vpl*rate)/(1-Math.pow(1+rate,-cashflows.length));

  document.getElementById("output").style.display="block";
  document.getElementById("output").innerHTML=`
    <strong>Resultados:</strong><br><br>
    VPL: R$ ${vpl.toFixed(2)}<br>
    TIR: ${tir.toFixed(2)}%<br>
    FV: R$ ${fv.toFixed(2)}<br>
    PMT: R$ ${pmt.toFixed(2)}<br>
    Payback simples: ${pay ?? "N√£o recupera"} per√≠odos<br>
    Payback descontado: ${payd ?? "N√£o recupera"} per√≠odos
  `;

  drawChart(cashflows);
}

function calcIRR(cfs){
  let r=0.1;
  for(let i=0;i<1000;i++){
    let f=0,df=0;
    cfs.forEach((cf,t)=>{
      f+=cf/Math.pow(1+r,t);
      df+=-t*cf/Math.pow(1+r,t+1);
    });
    r-=f/df;
  }
  return r;
}

function drawChart(cfs){
  let c=document.getElementById("chart");
  let ctx=c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);
  let acc=0;
  cfs.forEach((v,i)=>{
    acc+=v;
    ctx.fillStyle=v>=0?"#22c55e":"#ef4444";
    ctx.fillRect(i*60+20,60-v/50,30,v/50);
    ctx.fillStyle="#000";
    ctx.fillText(acc.toFixed(0),i*60+20,110);
  });
}
</script>

</body>
</html>
