<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>TIR, VPL, Payback e Montante | SimulaLucro</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Calculadora financeira estilo HP12c para TIR, VPL, Payback, PMT e Montante com fluxo de caixa ou pagamentos peri√≥dicos.">
<link rel="canonical" href="https://simulalucro.com.br/hp12c-like.html">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#f3f6fb;
  color:#1f2937;
  padding-bottom:90px;
}
header{
  position:sticky;
  top:0;
  background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.08);
  z-index:1000;
}
.header-inner{
  max-width:1100px;
  margin:auto;
  padding:14px 16px;
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
}
nav{
  width:100%;
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  font-size:14px;
  margin-top:8px;
}
nav a{text-decoration:none;color:#2563eb}
nav a.active{font-weight:bold;text-decoration:underline}

.container{
  max-width:900px;
  margin:auto;
  padding:24px 16px;
}
.card{
  background:#fff;
  padding:24px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
h1{margin-top:0}

.toggle{
  display:flex;
  gap:20px;
  margin:16px 0;
}

.flow-header, .flow-row{
  display:grid;
  grid-template-columns:110px 1fr 90px 36px;
  gap:8px;
  align-items:center;
  margin-bottom:8px;
}
.flow-header{font-weight:bold;font-size:13px}

input,select,button{
  padding:10px;
  border-radius:8px;
  border:1px solid #d1d5db;
  font-size:14px;
}
button{
  background:#2563eb;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{background:#1d4ed8}

.remove{background:#ef4444}

.result{
  background:#ecfeff;
  padding:16px;
  border-radius:12px;
  margin-top:20px;
}

canvas{margin-top:30px}

@media(max-width:600px){
  .flow-header,.flow-row{
    grid-template-columns:90px 1fr 80px 32px;
  }
}
</style>
</head>

<body>

<header>
  <div class="header-inner">
    <strong>üí∞ SimulaLucro</strong>
    <nav>
      <a href="index.html">In√≠cio</a>
      <a href="juros-compostos.html">Juros</a>
      <a class="active" href="#">HP12c-like</a>
    </nav>
  </div>
</header>

<main class="container">

<div class="card">
<h1>üìä TIR, VPL, Payback e Montante</h1>
<p>Calculadora financeira profissional com fluxo de caixa ou PMT (pagamento peri√≥dico).</p>

<div class="toggle">
<label><input type="radio" name="mode" checked onclick="setMode('flow')"> Fluxo de Caixa</label>
<label><input type="radio" name="mode" onclick="setMode('pmt')"> Usar PMT</label>
</div>

<!-- FLUXO -->
<div id="flowSection">
<div class="flow-header">
<div>Data</div><div>Valor (R$)</div><div>Tipo</div><div></div>
</div>
<div id="flows"></div>
<button onclick="addFlow()">+ Adicionar linha</button>
</div>

<!-- PMT -->
<div id="pmtSection" style="display:none">
<label>Valor Presente (PV)</label>
<input id="pv" placeholder="Ex: -10000">
<label>PMT</label>
<input id="pmt" placeholder="Ex: 500">
<label>Per√≠odos (N)</label>
<input id="n" placeholder="Ex: 24">
</div>

<label style="margin-top:16px">Taxa de desconto (% por per√≠odo)</label>
<input id="rate" placeholder="Ex: 1">

<button style="margin-top:16px" onclick="calculate()">Calcular</button>

<div id="output" class="result"></div>

<canvas id="chart"></canvas>

<hr>

<h3>üìò Como usar</h3>
<p><strong>Fluxo de Caixa:</strong> Informe o investimento inicial negativo na data zero e os retornos nos per√≠odos seguintes.</p>
<p><strong>PMT:</strong> Use para financiamentos, empr√©stimos ou investimentos com pagamentos iguais.</p>
<p>Este c√°lculo √© educativo e comparativo.</p>

</div>
</main>

<script>
let chart;

function setMode(m){
  flowSection.style.display = m==='flow'?'block':'none';
  pmtSection.style.display = m==='pmt'?'block':'none';
}

function addFlow(){
  const d=document.createElement('div');
  d.className='flow-row';
  d.innerHTML=`
  <input type="date">
  <input placeholder="Ex: 1000">
  <select><option>Entrada</option><option>Sa√≠da</option></select>
  <button class="remove" onclick="this.parentNode.remove()">x</button>`;
  flows.appendChild(d);
}
addFlow();

function irr(cf){
  let r=0.1;
  for(let i=0;i<1000;i++){
    let npv=0,d=0;
    for(let t=0;t<cf.length;t++){
      npv+=cf[t]/(1+r)**t;
      d+=-t*cf[t]/(1+r)**(t+1);
    }
    let nr=r-npv/d;
    if(Math.abs(nr-r)<1e-6) return r;
    r=nr;
  }
  return null;
}

function calculate(){
  const rate=Number(rateInput.value||rate.value)/100;
  let cashflows=[];
  let labels=[];
  let acc=[];
  let sum=0;

  if(flowSection.style.display==='block'){
    const rows=[...flows.children];
    rows.sort((a,b)=>new Date(a.children[0].value)-new Date(b.children[0].value));
    rows.forEach((r,i)=>{
      let v=Number(r.children[1].value)||0;
      if(r.children[2].value==='Sa√≠da') v*=-1;
      cashflows.push(v);
      sum+=v;
      acc.push(sum);
      labels.push(i);
    });
  }else{
    const PV=Number(pv.value)||0;
    const PMT=Number(pmt.value)||0;
    const N=Number(n.value)||0;
    cashflows=[PV];
    sum=PV; acc=[sum]; labels=[0];
    for(let i=1;i<=N;i++){
      sum+=PMT;
      cashflows.push(PMT);
      acc.push(sum);
      labels.push(i);
    }
  }

  const vpl=cashflows.reduce((a,v,i)=>a+v/(1+rate)**i,0);
  const tir=irr(cashflows);
  const fv=acc[acc.length-1];

  let paySimple="N√£o recupera";
  let payDisc="N√£o recupera";
  let c=0,cd=0;
  for(let i=0;i<cashflows.length;i++){
    c+=cashflows[i];
    cd+=cashflows[i]/(1+rate)**i;
    if(c>=0 && paySimple==="N√£o recupera") paySimple=i;
    if(cd>=0 && payDisc==="N√£o recupera") payDisc=i;
  }

  output.innerHTML=`
  <strong>Resultados</strong><br><br>
  VPL: R$ ${vpl.toFixed(2)}<br>
  TIR: ${tir?(tir*100).toFixed(2)+'%':'Indefinida'}<br>
  FV: R$ ${fv.toFixed(2)}<br>
  Payback simples: ${paySimple}<br>
  Payback descontado: ${payDisc}
  `;

  if(chart) chart.destroy();
  chart=new Chart(document.getElementById('chart'),{
    type:'bar',
    data:{
      labels,
      datasets:[
        {label:'Fluxo',data:cashflows,backgroundColor:'#2563eb'},
        {label:'Acumulado',data:acc,type:'line',borderColor:'#16a34a'}
      ]
    }
  });
}
</script>

</body>
</html>
