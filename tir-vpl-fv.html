<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>TIR, VPL, Payback e Montante | SimulaLucro</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Calculadora completa de TIR, VPL, Payback simples e descontado, Montante (FV) e PMT com data zero obrigat√≥ria.">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f3f6fb;
  color:#1f2937;
}
.header{
  background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.08);
}
.header-inner{
  max-width:1100px;
  margin:auto;
  padding:14px 16px;
  display:flex;
  gap:16px;
  flex-wrap:wrap;
}
.header a{color:#2563eb;text-decoration:none;font-weight:500}

.container{
  max-width:900px;
  margin:auto;
  padding:24px 16px;
}
.card{
  background:#fff;
  padding:24px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
h1,h2,h3{margin-top:0}

.grid-head,.grid-row{
  display:grid;
  grid-template-columns:90px 1fr 120px 40px;
  gap:8px;
  align-items:center;
}
.grid-head{
  font-weight:700;
  font-size:14px;
  margin-bottom:8px;
}
.grid-row input,.grid-row select{
  padding:8px;
  border-radius:8px;
  border:1px solid #d1d5db;
}
.btn{
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:10px;
  padding:10px 14px;
  font-weight:700;
  cursor:pointer;
}
.btn.gray{background:#374151}
.btn.small{padding:6px 10px}
.result{
  background:#ecfeff;
  padding:16px;
  border-radius:12px;
  margin-top:20px;
}
.note{
  font-size:14px;
  color:#374151;
}
@media(max-width:600px){
  .grid-head,.grid-row{
    grid-template-columns:70px 1fr 90px 36px;
  }
}
</style>
</head>

<body>

<header class="header">
  <div class="header-inner">
    <strong>üí∞ SimulaLucro</strong>
    <a href="index.html">In√≠cio</a>
    <a href="juros-compostos.html">Juros</a>
    <a href="tir-vpl-fv.html"><strong>TIR / VPL</strong></a>
  </div>
</header>

<main class="container">

<div class="card">
<h1>üìä TIR, VPL, Payback e Montante (FV)</h1>
<p>Analise investimentos com <strong>data zero obrigat√≥ria</strong>, fluxo de caixa validado e m√©tricas financeiras completas.</p>

<h2>Fluxo de Caixa</h2>

<div class="grid-head">
  <div>Per√≠odo</div>
  <div>Valor (R$)</div>
  <div>Tipo</div>
  <div></div>
</div>

<div id="rows"></div>

<button class="btn gray" onclick="addRow()">+ Adicionar per√≠odo</button>

<hr style="margin:24px 0">

<label><strong>Taxa de desconto (% ao per√≠odo)</strong></label><br>
<input id="rate" placeholder="Ex: 10" style="max-width:200px">

<br><br>
<button class="btn" onclick="calculate()">Calcular</button>

<div id="output" class="result" style="display:none"></div>

</div>

<div class="card" style="margin-top:32px">
<h2>üìò Explica√ß√£o das M√©tricas</h2>

<h3>VPL (Valor Presente L√≠quido)</h3>
<p>Indica quanto valor o investimento gera hoje. VPL &gt; 0 ‚Üí investimento vi√°vel.</p>

<h3>TIR (Taxa Interna de Retorno)</h3>
<p>Taxa que zera o VPL. S√≥ existe se houver <strong>investimento inicial negativo</strong> e retornos positivos.</p>

<h3>Payback Simples</h3>
<p>Tempo necess√°rio para recuperar o capital investido, sem considerar juros.</p>

<h3>Payback Descontado</h3>
<p>Considera o valor do dinheiro no tempo (mais realista).</p>

<h3>FV (Montante)</h3>
<p>Valor final acumulado do fluxo.</p>

<h3>PMT</h3>
<p>Pagamento peri√≥dico equivalente do investimento.</p>

<h3>Exemplo</h3>
<p>
Per√≠odo 0: -800<br>
Per√≠odos seguintes: +500, +200, -200, +700, +200<br>
Taxa: 10%
</p>

<p class="note">
‚ö†Ô∏è Esta calculadora tem finalidade educativa e comparativa. N√£o constitui recomenda√ß√£o financeira.
</p>
</div>

</main>

<script>
let rows = document.getElementById("rows");

function addRow(p=0,v="",t="Sa√≠da"){
  let r = document.createElement("div");
  r.className="grid-row";
  r.innerHTML=`
    <input type="number" value="${p}" class="p">
    <input type="number" value="${v}" class="v">
    <select class="t">
      <option ${t==="Sa√≠da"?"selected":""}>Sa√≠da</option>
      <option ${t==="Entrada"?"selected":""}>Entrada</option>
    </select>
    <button class="btn small" onclick="this.parentElement.remove()">√ó</button>
  `;
  rows.appendChild(r);
}

addRow(0,"","Sa√≠da");

function npv(rate,flows){
  return flows.reduce((a,f,i)=>a+f/Math.pow(1+rate,i),0);
}

function irr(flows){
  if(!flows.some(f=>f<0)||!flows.some(f=>f>0)) return null;
  let low=-0.99,high=1;
  for(let i=0;i<100;i++){
    let mid=(low+high)/2;
    let v=npv(mid,flows);
    if(Math.abs(v)<1e-6) return mid;
    v>0?low=mid:high=mid;
  }
  return (low+high)/2;
}

function calculate(){
  let rate = Number(rateInput.value)/100;
  let flows=[];
  let periods=[...document.querySelectorAll(".p")].map(e=>+e.value);
  let values=[...document.querySelectorAll(".v")].map(e=>+e.value);
  let types=[...document.querySelectorAll(".t")].map(e=>e.value);

  if(periods[0]!==0){
    alert("O per√≠odo 0 √© obrigat√≥rio.");
    return;
  }

  for(let i=0;i<values.length;i++){
    flows.push(types[i]==="Sa√≠da"?-values[i]:values[i]);
  }

  let vpl = npv(rate,flows);
  let tir = irr(flows);
  let fv = flows.reduce((a,f)=>a+f,0);

  let acc=0, payback=null, paybackD=null;
  flows.forEach((f,i)=>{
    acc+=f;
    if(acc>=0 && payback===null) payback=i;
  });

  acc=0;
  flows.forEach((f,i)=>{
    acc+=f/Math.pow(1+rate,i);
    if(acc>=0 && paybackD===null) paybackD=i;
  });

  let pmt = (vpl*rate)/(1-Math.pow(1+rate,-flows.length));

  output.style.display="block";
  output.innerHTML=`
    <strong>Resultados:</strong><br><br>
    VPL: R$ ${vpl.toFixed(2)}<br>
    TIR: ${tir===null?"N√£o aplic√°vel":(tir*100).toFixed(2)+"%"}<br>
    Montante (FV): R$ ${fv.toFixed(2)}<br>
    Payback simples: ${payback??"N√£o recupera"}<br>
    Payback descontado: ${paybackD??"N√£o recupera"}<br>
    PMT: R$ ${pmt.toFixed(2)}
  `;
}

const rateInput=document.getElementById("rate");
</script>

</body>
</html>
